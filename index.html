<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>虹靈御所｜八字人生兵法 v1.6 (Enhanced)</title>
<link rel="preconnect" href="https://cdn.jsdelivr.net"/>
<style>
:root { --bg:#0f1115; --card:#171a21; --text:#e6e9ef; --muted:#a6adbb; --acc:#6bc4ff; --border:#222; --danger:#e53935; --ok:#4caf50; --warn:#ffb300; --el-金:#b0c4de; --el-木:#6fbf73; --el-水:#42a5f5; --el-火:#ff7043; --el-土:#c4a676; }
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--text);font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto}
a{color:#8ad0ff}
.hdr{padding:20px 16px;border-bottom:1px solid var(--border)}
.hdr h1{margin:0 0 6px;font-size:22px}
.hdr .sub{margin:0;color:var(--muted);font-size:14px}
.wrap{max-width:1180px;margin:24px auto;padding:0 16px}
.card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:16px;margin:16px 0;box-shadow:0 2px 10px rgba(0,0,0,.25)}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:12px}
.grid-3{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:12px}
.grid input,.grid select,.grid-3 input,.grid-3 select{width:100%;padding:10px;border-radius:10px;border:1px solid #2a2f3a;background:#0e1015;color:var(--text);transition:border-color .25s, box-shadow .25s}
.grid input.valid{border-color:var(--ok);box-shadow:0 0 0 1px var(--ok) inset}
.grid input.invalid{border-color:var(--danger);box-shadow:0 0 0 1px var(--danger) inset}
.btn{padding:10px 14px;border-radius:10px;background:var(--acc);border:0;font-weight:600;cursor:pointer}
.actions{display:flex;gap:10px;flex-wrap:wrap}
.small{font-size:12px;color:var(--muted)}
.report{width:100%;border-collapse:collapse;margin-top:8px}
.report th,.report td{border:1px solid #2a2f3a;padding:10px;vertical-align:top}
.report th{background:#0e1015;color:#cfd6e6}
.pill{display:inline-block;background:#10131a;border:1px solid #2a2f3a;border-radius:999px;padding:.15rem .6rem;margin:0 6px 6px 0;font-size:12px}
.section-title{margin:.65rem 0 .35rem;color:var(--muted);font-size:13px;letter-spacing:.5px}
.story{white-space:pre-wrap;font-size:14px;line-height:1.5}
.badge{display:inline-block;padding:4px 8px;border-radius:8px;background:#1e2430;border:1px solid #2a2f3a;color:#a0d3ff;margin-right:6px;font-size:12px}
.footer{padding:24px 16px;color:var(--muted);text-align:center;font-size:12px}
.flex{display:flex;flex-wrap:wrap;gap:6px}
.el-tag{padding:4px 8px;border-radius:8px;font-size:12px;background:#20252e;border:1px solid #2a2f3a}
.el-金{background:var(--el-金);color:#142030} .el-木{background:var(--el-木);color:#102016}
.el-水{background:var(--el-水);color:#0e2234} .el-火{background:var(--el-火);color:#2d1008}
.el-土{background:var(--el-土);color:#22160a}
.hl-strong{outline:2px solid #ffd54f}
.cat-label{font-size:11px;padding:2px 6px;border-radius:6px;background:#253040;color:#9ecbff;margin-right:4px;display:inline-block}
.cat-貴人{background:#2d3f52}
.cat-吉星{background:#314d39}
.cat-桃花{background:#4d2f4d}
.cat-動星{background:#3d3a23}
.cat-陰煞{background:#46342c}
.cat-刑煞{background:#4b2d2d}
.fade{opacity:.7}
.note{font-size:11px;color:#8892a2;margin-top:6px}
@media (max-width:900px){.grid-3,.grid{grid-template-columns:1fr}}
</style>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
</head>
<body>
<header class="hdr">
  <h1>虹靈御所｜八字人生兵法 v1.6</h1>
  <p class="sub">重構 + 五行力量 + 神煞精緻化 + PDF 增強 + 故事細化 + 自動推時支 + 即時驗證。</p>
</header>
<main class="wrap">
  <section class="card">
    <h2>👤 基本資料</h2>
    <div class="grid-3">
      <label>姓名 <input id="name" placeholder="例：王小明"></label>
      <label>出生日期 <input id="birthDate" type="date"></label>
      <label>出生時間 <input id="birthTime" type="time" step="60"></label>
    </div>
    <div class="grid">
      <label>時區
        <select id="tz">
          <option value="UTC+08:00" selected>UTC+08:00（台灣/香港/新加坡）</option>
          <option value="UTC+09:00">UTC+09:00（日本/首爾）</option>
          <option value="UTC+07:00">UTC+07:00（東南亞部分）</option>
          <option value="UTC+00:00">UTC+00:00（倫敦）</option>
          <option value="UTC-05:00">UTC-05:00（紐約）</option>
          <option value="UTC-08:00">UTC-08:00（洛杉磯）</option>
        </select>
      </label>
      <label>子時劃日法
        <select id="ziCut">
          <option value="midnight" selected>子初不換日（00:00 換日）</option>
          <option value="23cut">夜子換日（23:00 換日）</option>
        </select>
      </label>
      <label>年柱干支 <input id="gzY" placeholder="例：甲子" maxlength="2"></label>
      <label>月柱干支 <input id="gzM" placeholder="例：丙寅" maxlength="2"></label>
      <label>日柱干支 <input id="gzD" placeholder="例：辛卯" maxlength="2"></label>
      <label>時支
        <select id="hourBranch">
          <option value="">（自動推或選）</option>
          <option value="子">子（23:00–00:59）</option><option value="丑">丑（01:00–02:59）</option>
          <option value="寅">寅</option><option value="卯">卯</option><option value="辰">辰</option><option value="巳">巳</option>
          <option value="午">午</option><option value="未">未</option><option value="申">申</option><option value="酉">酉</option>
          <option value="戌">戌</option><option value="亥">亥</option>
        </select>
      </label>
    </div>
    <div class="actions">
      <button class="btn" id="btnOpenCal" type="button">開萬年曆</button>
      <button class="btn" id="btnGuessHB" type="button">推時支</button>
      <button class="btn" id="btnPaste" type="button">貼上三柱</button>
      <button class="btn" id="btnCalc" type="button">計算</button>
      <button class="btn" id="btnPdf" type="button">下載 PDF</button>
    </div>
    <div class="small">年/月/日柱請以萬年曆為準；即時驗證：綠=合法干支，紅=格式錯誤；未選時支但填時間會自動推斷。</div>
  </section>
  <section class="card">
    <h2>📄 報告（四時軍團 × 十神 × 納音 × 五行 × 神煞分類）</h2>
    <div id="fiveElPanel" style="display:none;margin-bottom:12px">
      <div class="section-title">五行力量（天干=1, 納音=0.5）</div>
      <div id="fiveElTags" class="flex"></div>
      <div id="fiveElComment" class="note"></div>
    </div>
    <table class="report" id="report" style="display:none">
      <thead>
        <tr><th style="width:120px">軍團</th><th>綜合欄</th></tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
  </section>
  <section class="card">
    <h2>⚙️ 檢查 / Debug</h2>
    <div id="debug"></div>
  </section>
</main>
<footer class="footer">© 虹靈御所 Hong Ling Sanctuary — v1.6 Enhanced</footer>
<script type="module" src="./js/ui.js"></script>
</body>
</html>